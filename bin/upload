#!/usr/bin/env php
<?php

$paths = array(
		realpath(__DIR__ . '/../vendor/autoload.php'),
		realpath(__DIR__ . '/../../../../vendor/autoload.php'),
);
foreach ($paths as $path) {
		if (FALSE !== $path) {
				require $path;
		}
}
if (5 > count($argv)) {
	die('Upload command requires a total of four arguments in the following order: directory username password comment' . PHP_EOL);
}

list (, $directory, $username, $password, $comment) = $argv;

$uploader = new \NamelessCoder\TYPO3RepositoryClient\Uploader();
$directory = realpath($directory);
try {
	$result = $uploader->upload($directory, $username, $password, $comment);
} catch (\SoapFault $error) {
	echo 'SOAP error: ' . $error->getMessage() . PHP_EOL;
	exit(1);
} catch (\RuntimeException $error) {
	echo 'Runtime error: ' . $error->getMessage() . PHP_EOL;
	exit(1);
}

if (TRUE === isset($result[\NamelessCoder\TYPO3RepositoryClient\Connection::SOAP_RETURN_VERSION])) {
	echo 'Succesfully uploaded new version: ' . $result[\NamelessCoder\TYPO3RepositoryClient\Connection::SOAP_RETURN_VERSION] . PHP_EOL;
}

if (TRUE === isset($result[\NamelessCoder\TYPO3RepositoryClient\Connection::SOAP_RETURN_MESSAGES])) {
	foreach ($result[\NamelessCoder\TYPO3RepositoryClient\Connection::SOAP_RETURN_MESSAGES] as $index => $message) {
		echo 'Message #' . ($index + 1) . ': ' . $message . PHP_EOL;
	}
}

exit(0);
